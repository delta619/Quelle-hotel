<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>Register</title>

    <style>
        *{
  text-align:center;
  padding:5px;
}

li{
  list-style-type: none;
  text-align:left;
  padding-left:12%;
  padding-bottom:10%;
}
input{

}

.container{
  width:30%;
  text-align:center;
  margin:auto;
  padding-bottom:10px;
}

.submit{
background-color:transparent;
  color:black;
  border:1px solid black;
  width:40%;
  font-size:20px;
  transition:0.2s ease;
  text-align:center;
 }
.submit:hover{
  background-color: black;
  color:white;
  border:1px solid black;
  font-size:20px;
 }
.password, .username{
  width:80%;
}

    </style>
    <script>

        function register(){
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            let regexPass = /^(?=.*[@$!#%()*?&])[A-Za-z\d@$!%#()*?&]{8,}$/;
            let regexUser = /^[A-Za-z\d@$!%#()*?&]{1,}$/;



            if(!regexPass.test(password)){
                document.getElementById("error").innerText = "Your password must contain at least one special character and be at least 8 characters long.";
                return;
            }
            if(!regexUser.test(username)){
                document.getElementById("error").innerText = "Please enter a valid username";
                return;
            }
            fetch("/register", {
                method: "post",
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                },
                body: "username=" + username + "&password=" + password
            })
            .then(response => response.json())
            .then(response => {
                if(response.success){
                    alert("Account successfully created, please login to continue.")
                    window.location.href = "/login";
                } else {
                console.log(response.message)
                document.getElementById("error").innerText = response.message;
                }
            });
        }
    </script>

</head>
<body>

<div class="container">
    <div class="header">
        <h1>Register your account below:</h1>
    </div>

    <div>

        <ul>
            <li>USERNAME: <input class="username form-control" id="username" type="text" name="username">
            </li>

            <li>PASSWORD: <input class="password form-control" id="password" type="password" name="password">
            </li>
        </ul>

        <button style="cursor:pointer;"   class="submit" onclick="register()"  value="REGISTER">Register</button>

    </div>
    <span id="error" style="color:red;text-align:center"></span>
    <div class=" row">
        <p>Already have an account? <a href="/login">Signin</a></p>
    </div>

</div>

</body>
</html>